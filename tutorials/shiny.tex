% !TEX encoding = UTF-8 Unicode
\documentclass{beamer}

\usepackage{color}
\usepackage{fancyvrb}
\usepackage{gensymb}
\usepackage{hyperref}
\usepackage{listings}
\usepackage{textcomp}
\usepackage{tikz}

\usetikzlibrary{arrows,positioning,shapes,shapes.multipart} 
\tikzstyle{every picture}+=[remember picture]

\definecolor{mygreen}{rgb}{0.88,0.95,0.88}

\usetheme{Warsaw}

\title[Data Visualization with R - Shiny tutorial]{Data Visualization with R \\ Shiny tutorial}
\author{Ariane Ducellier}
\date{University of Washington - Fall 2023}

\begin{document}

	\begin{frame}
		\titlepage
	\end{frame}

	\begin{frame}
		\frametitle{What is Shiny?}
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Examples}

		Let us run several examples:

		\vspace{2em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		library(shiny)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{2em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		runExample("08_html")
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{2em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		runExample("01_hello")
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Examples}

		UI part:

		\begin{exampleblock}{}
		\begin{BVerbatim}
		ui <- fluidPage(
		  titlePanel(...),
		  sidebarLayout(
		    sidebarPanel(
		      sliderInput(
		        ...
		      )
		    ),
		    mainPanel(
		      plotOutput(outputId="distplot")
		    )
		  )
		)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Examples}

		Server part:

		\begin{exampleblock}{}
		\begin{BVerbatim}
		server <- function(input, output) {
		  output$distplot <- renderPlot({
		    ...
		  })
		}
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{2em}

		Creation of Shiny app:

		\begin{exampleblock}{}
		\begin{BVerbatim}
		shinyApp(ui=ui, server=server)
		\end{BVerbatim}
		\end{exampleblock}{}
	
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{R Markdown with interactive Shiny elements}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		Go to File >
		      New File >
		      R Markdown >
		      Shiny
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{2em}

		Fill the document with the code from \verb|tutorial_shiny_1.Rmd|.

		\vspace{2em}

		Click on \verb|Run Document|.
	
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Minimal example}

		We need the files \verb|ui.R| and \verb|server.R| that are kept within the same folder. \verb|ui.R| describe the user interface.

		\vspace{2em}		

		\begin{exampleblock}{}
		\begin{BVerbatim}
		fluidPage(...,
		    title = NULL, theme = NULL, lang = NULL)
		\end{BVerbatim}
		\end{exampleblock}{}

		indicates that we are going to use a fluid page layout with rows containing columns.

		\vspace{2em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		titlePanel(title, windowTitle = title)
		\end{BVerbatim}
		\end{exampleblock}{}

		describes the title of the application.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Minimal example}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		sidebarLayout(sidebarPanel,
		              mainPanel,
		              position = c("left", "right"),
		              fluid = TRUE)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{2em}

		describe the general layout of the page, with:
		\begin{itemize}
			\item Inputs on the side (\verb|sidebarPanel|),
			\item Outputs in the middle (\verb|mainPanel|).
		\end{itemize}
	
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Minimal example}

		The panels contain input and output widgets:

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		textInput(inputId = "comment",
		          label,
		          value = "",
		          width = NULL,
		          placeholder = NULL)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		textOutput(outputId = "textDisplay",
		           container = if (inline) span else div,
		           inline = FALSE)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\verb|server.R| contains functions which use \verb|inputid|	as an input, and produce \verb|outputId| as an output.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Minimal example}

		\verb|server.R| contains a function describing how to use the input from \verb|ui.R| to produce the outputs from \verb|ui.R|.

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		function(input, output){
		  output$textDisplay = renderText({...input$comment...
		  })
		 )
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		The \verb|function(input, output)| contains the reactive components of the application. For example:
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		renderText(expr,
		           env = parent.frame(),
		           quoted = FALSE,
		           func = NULL)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Run the minimal example}

		Set the working directory to the folder that contains \verb|ui.R| and \verb|server.R|,

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		setwd("/Users/my_name/Documents/my_folder/")
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		load the Shiny package:

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		library(shiny)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		and run the application:

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		runApp()
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Various widgets}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		checkboxGroupInput(inputId, label, choices=NULL, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		checkboxInput(inputId, label, value=FALSE, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		dateInput(inputId, label, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		dateRangeInput(inputId, label, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		numericInput(inputId, label, value, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		radioButtons(inputId, label, choices=NULL, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Various widgets}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		selectInput(inputId, label, choices, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		sliderInput(inputId, label, min, max, value, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		textInput(inputId, label, ...)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		To see an example of how the widgets look like, type:

		\vspace{1em}

		\begin{exampleblock}{}
		\begin{BVerbatim}
		library(shiny)
		runGist(6571951)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Panels}

		We can show multiple frames in screen and let the user select one. The processing of the data is only carried out for the currently selected tab.

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{BVerbatim}
		tabsetPanel(
		  tabPanel("title_text", textOutput("name_text")),
		  tabPanel("title_plot", plotoutput("name_plot")),
		  tabPanel("title_map", leafletOutput("name_map"))
		)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		The \verb|leaflet| package allows us to produce maps shown with \verb|leafletOutput| in the \verb|ui.R| and created with \verb|renderLeaflet| in the \verb|server.R| file.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Reactive objects}

		In the \verb|server.r| file, we filter the data using a reactive object:

		\vspace{1em}
		
		\begin{exampleblock}{}
		\begin{lstlisting}
		theData = reactive({
		  mapData %>%
		    filter(year >= input$year
		})
		\end{lstlisting}
		\end{exampleblock}{}

		\vspace{1em}

		\begin{itemize}
			\item A reactive object changes when its input changes.
			\item When it runs, the output is cached.
			\item If it is called several times in an application, it will not run again if the inputs are unchanged.
		\end{itemize}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Simple layouts}
		
		Left-to-right and top-to-bottom. The elements reorder themselves when resizing the window.
		\begin{exampleblock}{}
		\begin{BVerbatim}
		flowLayout( ... )
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		Top-to-bottom
		\begin{exampleblock}{}
		\begin{BVerbatim}
		verticalLayout( ... )
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		Left-to-right with manually set widths
		\begin{exampleblock}{}
		\begin{lstlisting}
		splitLayout(cellWidths = c("25%", "75%"),
		            ... ),
		\end{lstlisting}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Complete layouts}
		
		Side bar and main panel
		\begin{exampleblock}{}
		\begin{BVerbatim}
		fluidpage(
		  sidebarLayout(sidebarPanel, mainPanel, position))
		)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		Top level navigation bar and several tabs
		\begin{exampleblock}{}
		\begin{BVerbatim}
		navbarPage(title, tabPanel)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		Left navigation bar and several tabs
		\begin{exampleblock}{}
		\begin{BVerbatim}
		fluidpage(
		  navlistPanel(title, tabPanel)
		)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Complete layouts}
		
		Rows and columns. The sum of the widths of the columns must be equal to 12.
		\begin{exampleblock}{}
		\begin{BVerbatim}
		fluidpage(
		  fluidrow(
		    column(width=4, ...),
		    column(width=4, ...), ... ))
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		Combination of layouts
		\begin{exampleblock}{}
		\begin{BVerbatim}
		fluidPage(
		  fluidRow(
		    column(width=4, ...), column(width=8, ...)),
		  splitLayout( ... ),
		  verticalLayout( ... )
		)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Hiding elements}
		
		Name the panels:
		\begin{exampleblock}{}
		\begin{BVerbatim}
		tabsetPanel(id = "theTabs",
		  tabPanel( ... , value = "trend"),
		  ...
		)
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		Add a condition to show an UI element only if a tab is selected:
		\begin{exampleblock}{}
		\begin{BVerbatim}
		conditionalpanel(
		  condition = "input.theTabs == ‘trend’",
		  checkboxInput( ... )
		)
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Tables - Basic Shiny}
		
		In \verb|ui.R|:
		\begin{exampleblock}{}
		\begin{BVerbatim}
		tableOutput("textDisplay")
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		In \verb|server.R|
		\begin{exampleblock}{}
		\begin{BVerbatim}
		output$textDisplay = renderTable({
		  getMat = matrix(c( ... ), ncol = 2, byrow = TRUE)
		  colnames(getMat) = c("Value", "Class")
		  getMat
		})
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Tables - With package DT (DataTable)}
		
		In \verb|ui.R|:
		\begin{exampleblock}{}
		\begin{BVerbatim}
		dataTableOutput("countryTable")
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		In \verb|server.R|
		\begin{exampleblock}{}
		\begin{BVerbatim}
		output$countryTable = renderDataTable({
		  dataTable(
		    ... ,
		    colnames = ... ,
		    caption = ... ,
		    filter = "top",
		    options = list(pageLength = 15,
		                   lengthMenu = c(10, 20, 50))
		})
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Reactive user interfaces}
		
		In \verb|ui.R|:
		\begin{exampleblock}{}
		\begin{BVerbatim}
		uiOutput("yearSelectorUI")
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		In \verb|server.R|
		\begin{exampleblock}{}
		\begin{BVerbatim}
		output$yearSelectorUI = renderUI(
		  selectedYears = ...
		  selectInput( ... , selectedYears)
		})
		\end{BVerbatim}
		\end{exampleblock}{}

		\vspace{1em}

		When the value in \verb|selectedYears| change, the choice of years in the widget will also change.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Progress bar}

		If some computation in \verb|server.R| can take a long time, it is useful to wrap the corresponding code inside the Shiny \verb|withProgress()| function.

		\vspace{1em}

		In \verb|server.R|
		\begin{exampleblock}{}
		\begin{BVerbatim}
		withProgress(message = ... ,
		  detail = ‘ ... ‘, value = 0,
		  ... function code ...
		  incProgress(1/3)
		  ... function code ...
		  incProgress(1/3)
		  ... function code ...
		  incProgress(1/3)
		  ... function code ...
		})
		\end{BVerbatim}
		\end{exampleblock}{}

	\end{frame}
	
\end{document}
