% !TEX encoding = UTF-8 Unicode
\documentclass{beamer}

\usepackage{color}
\usepackage{fancyvrb}
\usepackage{gensymb}
\usepackage{hyperref}
\usepackage{textcomp}

\usetheme{Warsaw}

\title[Ggplot2 tutorial]{Data Visualization with R - Ggplot2 tutorial}
\author{Ariane Ducellier}
%\date{}

\begin{document}

	\begin{frame}
		\titlepage
	\end{frame}

	\begin{frame}
		Something about ggplot2 and why we are learning it
	\end{frame}

	\begin{frame}
		\frametitle{Main concepts of Ggplot2}

		Ggplot2 is made of geometric objects (e.g, lines, bars, points) that are used to visualize data.

		Examples of one-dimensional objects for one-dimensional data:
		\begin{itemize}
			\item histogram
			\item bar-chart
		\end{itemize}

		Two-dimensional objects for the relationship between two variables:

	\end{frame}

	\begin{frame}
		\frametitle{Main concepts of Ggplot2}
		
		To the geometric objects, we are going to add aesthetics:
		\begin{itemize}
			\item Coordinates scale,
			\item Fonts,
			\item Colors...
		\end{itemize}

		The aesthetics are described using the grammar of graphics.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Example: Histograms}

		Built-in R graphics package:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		hist(airquality$Temp)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		Quick plot using ggplot2:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		qplot(airquality$Temp)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Ggplot2 command structure}

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(airquality, aes(x=Temp))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

dataset, aes = describe the variables from the dataset that we want to visualize and their qualities)

		This command does not plot anything.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Ggplot2 command structure}

		We need to add a command to explain the kind of object that we want to plot:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(airquality, aes(x=Temp)) + geom_histogram()
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Bar plots}

		We can use bar plots to visualize one categorical variable:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		df_desc <- read.csv("../data/
		    historical-hourly-weather-data/
		    weather_description.csv")
		ggplot(df_desc, aes(x=Vancouver)) + geom_bar()
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		The height of the bar is proportional to the number of cases in each group.
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Bar plots}

		Or a combination of a categorical variable and a continuous variable:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(RetailSales, aes(x=Month, y=Sales)) + 
		geom_bar(stat="identity")
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		Using \verb|stat = "identity"| tells ggplot2 to sum the values for each group (Month) and plot bars proportional to the sums.
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Box plots}


		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df_hum, aes(x=month, y=Vancouver)) + 
		geom_boxplot()
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Scatter plots and line plots}

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df, aes(x=time, y=distance)) + geom_point()
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df, aes(x=time, y=distance)) + geom_line()
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Changing histogram defaults}

		Modify the number of bins:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df_hum, aes(x=Vancouver)) + 
		geom_histogram(bins=15)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		Modify the filling and the color:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df_hum, aes(x=Vancouver)) + 
		geom_histogram(bins=15, fill="white", color=1)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Adding aesthetics to the plot}

		Add title and axis labels:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df_hum, aes(x=Vancouver)) + 
		geom_histogram(bins=15, fill="white", color=1) +
		ggtitle("Humidity for Vancouver city") +
		xlab("Humidity") +
		theme(axis.text.x=element_text(size=12),
		axis.text.y=element_text(size=12))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Adding aesthetics to the boxplot}

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df_hum, aes(x=month, y=Vancouver)) + 
		geom_boxplot(color=1, fill=3) + 
		ylab("Humidity") + 
		theme(axis.text.x=element_text(size=15),
		axis.text.y=element_text(size=15),
		axis.title.x=element_text(size=15, color=2),
		axis.title.y=element_text(size=15, color=2))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}
		
	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Layers}

		Each plot can be thought as a separate variable, and the sum of the variables will make the final plot. You can define:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p1 <- ggplot(df,
		      aes(x=Electricity_consumption_per_capita))
		p2 <- p1 + geom_histogram()
		p3 <- p1 + geom_histogram(bins=15)
		p4 <- p3 + xlab("Electricity consumption per capita")
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		and you can choose to plot \verb|p2|, \verb|p3|, or \verb|p4|.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Scales}

		Scales \verb|scale_x_continuous| or \verb|scale_x_discrete| can be used to specify the axes. \verb|name|, \verb|limits|, \verb|breaks|, and \verb|labels| are the main parameters that can be adjusted.

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p1 <- ggplot(df, aes(x=gdp_per_capita))
		p2 <- p1 + geom_histogram()
		p3 <- p2 + scale_x_continuous(
		           name« "GDP per capita »),
		           limits=c(0, 50000),
		           breaks=seq(0, 40000, 4000),
		           labels=c("0K", "4K", "8K", "12K", "16K",
		           "20K",  "24K", "28K", "32K", "36K", "40K"))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Polar coordinates}

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		t <- seq(0, 360, by=15)
		r <- 2
		qplot(r, t) +
		coord_polar(theta="y") +
		scale_y_continuous(breaks=seq(0, 360, 30))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Facets}

		A Trellis display allows creating a plot for each group of a categorical variable:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p <- ggplot(df,
		     aes(x=gdp_per_capita,
		     y=Electricity_consumption_per_capita)) +
		     geom_point()
		p + facet_grid(Country ~ .)
		p + facet_grid(. ~ Country)
		p + facet_wrap(~Country)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		You can group subplots horizontally, vertically or wrapped together.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Shapes and colors}

		You can change shape and color for the entire plot:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df, aes_string(x=var1, y=var2)) +
		geom_point(color=2, shape=2)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		Or assign a different shape and color for each group of a categorical variable:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		ggplot(df, aes_string(x=var1, y=var2)) +
		geom_point(aes(color=Country, shape=Country))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Themes}

		Theme is used to change the non-data elements of the plot:

		\begin{center}
		\begin{tabular}{|l|l|l|}
		\hline
    		Theme & Type & Arguments \\ 
		\hline
		axis.title.x & element\_text & size, color, family, angle \\
		\hline
		axis.title.y & element\_text & size, color, family, angle \\
		\hline
		plot.background & element\_rect & fill, color, linewidth \\
		\hline
		panel.background & element\_rect & fill, fill, color, line width \\
		\hline
		panel.grid.major & element\_line & color, linetype, linewidth \\
		\hline
		\end{tabular}
		\end{center}

		Type \verb|?theme| to show all possible types of themes, their types and their arguments.

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Themes}

		You can add themes to the plot to customize the non-data elements:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p1 <- ggplot(dfn, aes(Genre, WorldGross)) 
		p2 <- p1+ geom_bar(aes(fill=LeadStudio), 
		                    stat="Identity", position="dodge")
		p3 <- p2 + theme(axis.title.x=element_text(size=15),
		                 axis.title.y=element_text(size=15),
		plot.background=element_rect(fill="gray87"),
		panel.background = element_rect(fill="beige"),
		panel.grid.major = element_line(color="Gray",
		                                linetype=1))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Themes}

		You can also use predefined themes:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p2 + theme_bw() + ggtitle("theme_bw()")
		p2 + theme_classic() + ggtitle("theme_classic()")
		p2 + theme_classic() + ggtitle("theme_gray()")
		p2 + theme_minimal() + ggtitle("theme_minimal()")
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Themes}

		You can also use define your own theme:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		mytheme <- theme(legend.title=element_blank(),
		legend.position="bottom",
		text=element_text(colour="Blue"),
		axis.text=element_text(size=12, color="Red"),
		axis.title=element_text(size=rel(1.5)))
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		and use it for a single plot:
		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p2 + mytheme + ggtitle("Changed Plot with my theme")
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

		or for all the plots by placing it at the beginning of your code:

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		theme_set(my_theme)
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

	\begin{frame}[fragile]
		\frametitle{Themes}

		You can also change the color palette.

		Type \verb|?scale_fill_brewer| to see all the color palettes available.

		\begin{exampleblock}{}
		\begin{center}
		\begin{BVerbatim}
		p4 <- p2 + theme_bw() + ggtitle("theme_bw()")
		p4 + scale_fill_brewer(palette="Spectral")
		\end{BVerbatim}
		\end{center}
		\end{exampleblock}{}

	\end{frame}

\end{document}
